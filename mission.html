<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="assets/images/logo.ico">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/mission.css">

    <script src="js/tool.js"></script>
    <script src="js/mission.js" defer></script>

    <title>Reset Point — 任務</title>
</head>

<body>
    <div id="mission" class="content">
        <div class="topTool">
            <div class="leave">
                <a href="index.html">
                    <button class="tool">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6 icon">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
                        </svg>
                    </button>
                </a>
            </div>
            <p id="topTitle" class="jersey-15">MISSION</p>
            <div class="toolGroup">
                <button class="tool" id="resetpjBtn"></button>
                <button class="tool" id="removeBtn"></button>
                <button class="tool" id="musicBtn"></button>
                <button class="tool" id="settingBtn"></button>
            </div>
        </div>
        <div id="missionBody">
            <div id="topBar">
                <p class="lxgw-wenkai">主線任務</p>
            </div>
            <p id="clearAll" class="jersey-15">ALL CLEAR !</p>
        </div>
    </div>

    <script>
        /*const userJson = localStorage.getItem('ResetPoint');
        const user = JSON.parse(userJson);
        console.log(user)

        user.missions['mission01'].currentProgress = [2, 3, 4, 5].reduce((count, idx) => {
            return count + (user.missions[`mission0${idx}`].rewardClaimed === true ? 1 : 0);
        }, 0);
        user.missions['mission02'].currentProgress = Math.min(user.completedChapter, user.missions['mission02'].maxProgress)
        user.missions['mission03'].currentProgress = Math.min(user.completedChapter, user.missions['mission03'].maxProgress)
        user.missions['mission04'].currentProgress = Math.min(user.completedChapter, user.missions['mission04'].maxProgress)
        user.missions['mission05'].currentProgress = user.completedEndings

        if (user.missions['mission01'].rewardClaimed) {
            document.getElementById('clearAll').style.display = 'block'
        }

        const missionDetail = {
            mission01: {
                id: 'mission01',
                describe: '完成[甜蜜偽像]所有任務',
                currentProgress: user.missions['mission01'].currentProgress,
                maxProgress: user.missions['mission01'].maxProgress,
                rewardClaimed: user.missions['mission01'].rewardClaimed,
            },
            mission02: {
                id: 'mission02',
                describe: '完成一個節點',
                currentProgress: user.missions['mission02'].currentProgress,
                maxProgress: user.missions['mission02'].maxProgress,
                rewardClaimed: user.missions['mission02'].rewardClaimed,
            },
            mission03: {
                id: 'mission03',
                describe: '完成三個節點',
                currentProgress: user.missions['mission03'].currentProgress,
                maxProgress: user.missions['mission03'].maxProgress,
                rewardClaimed: user.missions['mission03'].rewardClaimed,
            },
            mission04: {
                id: 'mission04',
                describe: '完成五個節點',
                currentProgress: user.missions['mission04'].currentProgress,
                maxProgress: user.missions['mission04'].maxProgress,
                rewardClaimed: user.missions['mission04'].rewardClaimed,
            },
            mission05: {
                id: 'mission05',
                describe: '通關[甜蜜偽像]所有結局',
                currentProgress: user.missions['mission05'].currentProgress,
                maxProgress: user.missions['mission05'].maxProgress,
                rewardClaimed: user.missions['mission05'].rewardClaimed,
            }
        }

        const missionBody = document.getElementById('missionBody');

        Object.entries(missionDetail).forEach(([key, mission], idx) => {
            const data = user.missions[key];

            // 如果 rewardClaimed 已经 true，整個任務 div 不显示，直接跳过渲染
            //if (data.rewardClaimed) return;

            const container = document.createElement('div');
            container.id = mission.id;

            // 计算填充条宽度，防止 maxProgress 为0除错
            const fillWidth = data.maxProgress > 0 ? (data.currentProgress / data.maxProgress) * 100 : 0;

            container.innerHTML = `
        <div class="perMission">
            <p class="lxgw-wenkai">${mission.describe}</p>
            <div>
                <div class="missionBar" style="display: block;">
                    <div id="missionFill${key.toString().padStart(2, '0')}" class="fillMissionBar" style="width: ${fillWidth}%"></div>
                </div>
                <button id="missionClear${key.toString().padStart(2, '0')}" class="clear jersey-15" style="display: none;">CLEAR</button>
                <p id="missionRecord${key.toString().padStart(2, '0')}" class="missionRecord jersey-15" style="display: block;">
                    (${data.currentProgress}/${data.maxProgress})
                </p>
            </div>
        </div>
        <div class="line"></div>
    `;

            missionBody.appendChild(container);

            // 取得這個任務區塊內的元素，準備依條件調整顯示
            const missionBar = container.querySelector('.missionBar');
            const missionRecord = container.querySelector('.missionRecord');
            const clearBtn = container.querySelector('button.clear');

            // 條件判斷：
            if (
                data.currentProgress === data.maxProgress &&
                user.missions[key].rewardClaimed === false
            ) {
                // 完成且第一任務獎勵未領，隱藏進度條和記錄文字，顯示按鈕
                missionBar.style.display = 'none';
                //missionRecord.style.display = 'none';
                clearBtn.style.display = 'block';
            } else {
                // 其他情況，顯示進度條和文字，隱藏按鈕
                missionBar.style.display = 'block';
                //missionRecord.style.display = 'block';
                clearBtn.style.display = 'none';
            }

            if (data.rewardClaimed) {
                container.style.display = 'none';
            }

            clearBtn.addEventListener('click', () => {
                // 將任務設為已領取
                data.rewardClaimed = true;

                // 隱藏該任務容器
                container.style.display = 'none';

                user.missions[key].rewardClaimed = true
                localStorage.setItem('ResetPoint', JSON.stringify(user));
                window.location.href = ''

                // 你可以在這裡加入資料儲存邏輯，例如：
                // localStorage.setItem('userData', JSON.stringify(user));
                // 或 post 到伺服器
            });
        });*/

    </script>
</body>

</html>