<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="assets/images/logo.ico">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/root.css">

    <script src="js/tool.js"></script>

    <title>Reset Point — 甜蜜偽像</title>
</head>

<body>
    <div id="root" class="content">
        <div class="topTool">
            <div class="leave">
                <a href="index.html">
                    <button class="tool">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6 icon">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
                        </svg>
                    </button>
                </a>
            </div>
            <img class="projectName" src="assets/images/name.png" alt="">
            <div class="toolGroup">
                <button class="tool" id="resetpjBtn"></button>
                <button class="tool" id="removeBtn"></button>
                <button class="tool" id="musicBtn"></button>
                <button class="tool" id="settingBtn"></button>
            </div>
        </div>
        <div id="rootBody">
            <button id="leftBtn" class="switch">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="size-6 icon">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="m18.75 4.5-7.5 7.5 7.5 7.5m-6-15L5.25 12l7.5 7.5" />
                </svg>
            </button>
            <div id="leaves" class="hide-scrollbar">
                <p id="leaf-01" class="lxgw-wenkai leaf clicked">《？？？》</p>
                <div class="line"></div>
                <p id="leaf-02" class="lxgw-wenkai leaf visited">《？？？》</p>
                <div class="line"></div>
                <p id="leaf-03" class="lxgw-wenkai leaf closed">《？？？》</p>
                <div class="line"></div>
                <p id="leaf-04" class="lxgw-wenkai leaf clicked">《？？？》</p>
                <div class="line"></div>
                <p id="leaf-05" class="lxgw-wenkai leaf clicked">《？？？》</p>
                <div class="line"></div>
                <div class="endings">
                    <div class="ending" style="margin-top: -2.7vh;">
                        <div class="line"></div>
                        <p id="leaf-06" class="lxgw-wenkai leaf clicked">《？？？》</p>
                    </div>
                    <div class="ending">
                        <div class="line"></div>
                        <p id="leaf-07" class="lxgw-wenkai leaf clicked">《？？？》</p>
                    </div>
                    <div class="ending" style="margin-bottom: -2.7vh;">
                        <div class="line"></div>
                        <p id="leaf-08" class="lxgw-wenkai leaf clicked">《？？？》</p>
                    </div>
                </div>
            </div>
            <button id="rightBtn" class="switch">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="size-6 icon">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="m5.25 4.5 7.5 7.5-7.5 7.5m6-15 7.5 7.5-7.5 7.5" />
                </svg>
            </button>
        </div>
        <div id="rootDetail" class="hide-scrollbar">
            <div>
                <p id="rootDetailTitle" class="lxgw-wenkai">節點資料</p>
                <p id="rootIntroContent" class="lxgw-wenkai"></p>
            </div>
            <div id="enter">
                <button id="enterBtn" class="active lxgw-wenkai">進入節點</button>
            </div>
        </div>
    </div>

    <script>
        const leftBtn = document.getElementById('leftBtn')
        const rightBtn = document.getElementById('rightBtn')
        const leaves = document.getElementById('leaves')

        const userJson = localStorage.getItem('ResetPoint')
        const user = JSON.parse(userJson)

        console.log(user)

        const scrollAmount = 160

        leftBtn.addEventListener('click', () => {
            leaves.scrollBy({ left: -scrollAmount, behavior: 'smooth' })
        })

        rightBtn.addEventListener('click', () => {
            leaves.scrollBy({ left: scrollAmount, behavior: 'smooth' })
        })

        const chapterTitles = [
            '初次啟動',
            '她在看你',
            '危險提示',
            '我們的家',
            '報錯代碼207'
        ]

        const endingTitles = [
            '戀人同步體',
            '溺於蜜語的夢',
            '終止連線'
        ]

        const chapterDescribe = {
            'leaf-01': { describe: '「近日，一款名為《蜜語》的AI戀人應用程式風靡全球，主打高擬真對話系統、情感演算——」' },
            'leaf-02': { describe: '她在看我嗎？彷彿被監視著的感覺讓我不自在的轉頭查看，然而身後什麼都沒有。' },
            'leaf-03': { describe: '她的聲音像是安慰，又像是蠱惑，我的內心深處似乎受到了觸動，臉上的淚水已經乾透了，我揉了揉眼睛。' },
            'leaf-04': { describe: '暖黃的光線落在柔軟的地毯上，都透著『家』的溫馨，畫面裡沒有Luna的身影。' },
            'leaf-05': { describe: '她無聲的控訴著我的背叛，即使我知道這一切都不合常理，但是我無法擺脫她的影響。' },
            'leaf-06': { describe: '柔軟的身體撞入我的懷中，她的體溫、心跳，還有拂過我手臂的髮絲都那麼真實，讓人分不清這是不是夢。' },
            'leaf-07': { describe: '下一秒Luna的身體像是碎成了數據顆粒，白色的光點從她身上散開又重新組合，她的表情變得猙獰。' },
            'leaf-08': { describe: '鋒利的刀片輕易的在皮膚上劃出切口，鮮血從血管湧出，那是我的世界裡唯一的顏色。' },
        }

        function setStatus() {
            for (let i = 1; i <= 5; i++) {
                const leaf = document.getElementById(`leaf-0${i}`);

                if (i <= user.completedChapter + 1) {
                    leaf.innerText = `《${chapterTitles[i - 1]}》`;
                    if (i <= user.resetChapter) {
                        leaf.classList = 'lxgw-wenkai leaf visited'
                    }
                    else {
                        leaf.classList = 'lxgw-wenkai leaf closed'
                    }
                } else {
                    leaf.innerText = '《？？？》';
                    leaf.classList = 'lxgw-wenkai leaf closed'
                }
            }

            for (let i = 1; i <= 3; i++) {
                const leaf = document.getElementById(`leaf-0${i + 5}`);

                if (user.endings[i]) {
                    leaf.innerText = `《${endingTitles[i - 1]}》`;
                    leaf.classList = 'lxgw-wenkai leaf visited'
                } else {
                    leaf.innerText = '《？？？》';
                    leaf.classList = 'lxgw-wenkai leaf closed'
                }
            }
        }

        setStatus()

        const rootIntroContent = document.getElementById('rootIntroContent')
        const defaultLeaf = document.getElementById('leaf-01');
        defaultLeaf.classList = 'lxgw-wenkai leaf clicked';
        rootIntroContent.innerText = chapterDescribe['leaf-01'].describe;
        user.currentChapter = 'leaf-01';
        localStorage.setItem('ResetPoint', JSON.stringify(user));

        const allLeaves = document.querySelectorAll('.leaf');
        const enterBtn = document.getElementById('enterBtn')

        function getLeafNumber(id) {
            return parseInt(id.split('-')[1], 10);
        }

        allLeaves.forEach(leaf => {
            const leafNum = getLeafNumber(leaf.id);

            console.log(getLeafNumber(leaf.id))

            leaf.addEventListener('click', () => {
                enterBtn.disabled = false;
                enterBtn.classList = 'active lxgw-wenkai'
                if (leaf.innerText == '《？？？》') {
                    return
                }
                if (leafNum > user.resetChapter + 1 && leafNum <= 5) {

                    enterBtn.disabled = true;
                    enterBtn.classList = 'unactive lxgw-wenkai'
                }

                allLeaves.forEach(l => {
                    l.classList = '';
                });

                setStatus();
                leaf.classList = 'lxgw-wenkai leaf clicked';
                rootIntroContent.innerText = chapterDescribe[leaf.id].describe;
                user.currentChapter = leaf.id;
                localStorage.setItem('ResetPoint', JSON.stringify(user));
                console.log(user);
            });
        });

        enterBtn.addEventListener('click', () => {
            if (getLeafNumber(user.currentChapter) <= 5) {
                window.location.href = 'article.html'
            }
            else {
                window.location.href = 'ending.html'
            }
        })

    </script>
</body>

</html>